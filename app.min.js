const DEBUG=!0;let g_xlsxData=[],g_members={},g_monthInReports=[],logger;function extractMonth(d){let a=/年\d+月/gm,b,c;for(;null!==(b=a.exec(d));)b.index===a.lastIndex&&a.lastIndex++,b.forEach((a,b)=>{c=a});return c=c.replace("\u5E74","")}function bytesToSize(a){if(0==a)return"0 Byte";var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,b),2)+" "+["Bytes","KB","MB","GB","TB"][b]}function getFirstDayOfCurrentMonth(){let a=new Date,c=a.getFullYear(),b=a.getMonth()+1;return`${c}${b=b.toString().padStart(2,"0")}01`}$(document).ready(function(){let a={LAST_NAME:"\u30C1\u30E3\u30D7\u30BF\u30FC\u25BA \u30B5\u30DE\u30EA\u30FCPALMS\u30EC\u30DD\u30FC\u30C8",FIRST_NAME:"__EMPTY",ATTENDANCE:"__EMPTY_1",ABSENT:"__EMPTY_2",LATE:"__EMPTY_4",REFERRAL:"__EMPTY_8",REFERRAL2:"__EMPTY_9",VISITOR:"__EMPTY_13",TYFCB:"__EMPTY_15",CEU:"__EMPTY_16",RECOMMENDATION:"__EMPTY_17",REPORT_DATE:"__EMPTY_9",REPORT_DATE_NICE:"REPORT_DATE_NICE",LAST_NAME_NICE:"LAST_NAME_NICE",FIRST_NAME_NICE:"FIRST_NAME_NICE",ATTENDANCE_NICE:"ATTENDANCE_NICE",ABSENT_NICE:"ABSENT_NICE",LATE_NICE:"LATE_NICE",REFERRAL_NICE:"REFERRAL_NICE",REFERRAL2_NICE:"REFERRAL2_NICE",REFERRAL_FINAL:"REFERRAL_FINAL",VISITOR_NICE:"VISITOR_NICE",TYFCB_NICE:"TYFCB_NICE",CEU_NICE:"CEU_NICE",RECOMMENDATION_NICE:"RECOMMENDATION_NICE"};function b(a){let b=new d;b.parseExcel(a)}logger=new Logger(!0),$(".file-multiple").change(function(e){g_xlsxData=[],g_members=[],g_monthInReports=[],$(".files").html(),$(".message").hide();let c=e.target.files;if(6!=c.length){(function(a){if(!a||""==a){$(".message").hide();return}$(".message__text").text(a),$(".message").show()})("You need to upload 6 files for score analysis.");return}for(let d=0,f=c.length;d<f;d++)b(c[d]);(function(b=[]){let c="";for(let a=0,e=b.length;a<e;a++){let d=b[a];c+=`<li>${d.name}（${bytesToSize(d.size)}）</li>`}$(".files").html(c)})(c),setTimeout(function(){var b;(function(){console.log(g_xlsxData);let b,k,l,m,n,o,p,h,i,q,r,s,t,d,w={},j=[];for(let u=0,x=g_xlsxData.length;u<x;u++){let f=g_xlsxData[u],e;e=(e=f[4])[a.REPORT_DATE],g_monthInReports.includes(e)||g_monthInReports.push(e),w[e]||(w[e]=f);for(let g=0,y=f.length-3;g<y;g++)g<7||(f[g][a.REPORT_DATE_NICE]=e,j.push(f[g]))}console.log(j);for(let v=0,z=j.length;v<z;v++){let c=j[v];l=c[Object.keys(c)[0]],m=c[a.FIRST_NAME],b=`${l} ${m}`,n=Number(c[a.ATTENDANCE]),o=Number(c[a.ABSENT]),p=Number(c[a.LATE]),h=Number(c[a.REFERRAL]),i=Number(c[a.REFERRAL2]),k=h+i,q=Number(c[a.VISITOR]),r=Number(c[a.TYFCB]),s=Number(c[a.CEU]),t=Number(c[a.RECOMMENDATION]),d=c[a.REPORT_DATE_NICE],g_members[b]?(n+=g_members[b][a.ATTENDANCE_NICE],o+=g_members[b][a.ABSENT_NICE],p+=g_members[b][a.LATE_NICE],h+=g_members[b][a.REFERRAL_NICE],i+=g_members[b][a.REFERRAL2_NICE],k+=g_members[b][a.REFERRAL_FINAL],q+=g_members[b][a.VISITOR_NICE],r+=g_members[b][a.TYFCB_NICE],s+=g_members[b][a.CEU_NICE],t+=g_members[b][a.RECOMMENDATION_NICE]):g_members[b]={},g_members[b][a.LAST_NAME_NICE]=l,g_members[b][a.FIRST_NAME_NICE]=m,g_members[b][a.ATTENDANCE_NICE]=n,g_members[b][a.ABSENT_NICE]=o,g_members[b][a.LATE_NICE]=p,g_members[b][a.REFERRAL_NICE]=h,g_members[b][a.REFERRAL2_NICE]=i,g_members[b][a.REFERRAL_FINAL]=k,g_members[b][a.VISITOR_NICE]=q,g_members[b][a.TYFCB_NICE]=r,g_members[b][a.CEU_NICE]=s,g_members[b][a.RECOMMENDATION_NICE]=t,g_members[b][a.REPORT_DATE_NICE]||(g_members[b][a.REPORT_DATE_NICE]={}),g_members[b][a.REPORT_DATE_NICE][d]||(g_members[b][a.REPORT_DATE_NICE][d]={}),g_members[b][a.REPORT_DATE_NICE][d][a.ATTENDANCE_NICE]=Number(c[a.ATTENDANCE]),g_members[b][a.REPORT_DATE_NICE][d][a.ABSENT_NICE]=Number(c[a.ABSENT]),g_members[b][a.REPORT_DATE_NICE][d][a.LATE_NICE]=Number(c[a.LATE]),g_members[b][a.REPORT_DATE_NICE][d][a.REFERRAL_NICE]=Number(c[a.REFERRAL]),g_members[b][a.REPORT_DATE_NICE][d][a.REFERRAL2_NICE]=Number(c[a.REFERRAL2]),g_members[b][a.REPORT_DATE_NICE][d][a.REFERRAL_FINAL]=Number(c[a.REFERRAL])+Number(c[a.REFERRAL2]),g_members[b][a.REPORT_DATE_NICE][d][a.VISITOR_NICE]=Number(c[a.VISITOR]),g_members[b][a.REPORT_DATE_NICE][d][a.TYFCB_NICE]=Number(c[a.TYFCB]),g_members[b][a.REPORT_DATE_NICE][d][a.CEU_NICE]=Number(c[a.CEU]),g_members[b][a.REPORT_DATE_NICE][d][a.RECOMMENDATION_NICE]=Number(c[a.RECOMMENDATION])}console.log(g_members)})(),$(".export-score").removeAttr("disabled")},1e3)}),$(".export-score").click(function(){(function(){let h=new c(a),p=[["","\u203B1\u3000\u4ECA\u6708\u306A\u306B\u3082\u6D3B\u52D5\u3057\u306A\u3044\u5834\u5408\u306E\u5408\u8A08\u6570\u5024"],["","","","\u53C2\u52A0","\u6B20\u5E2D","","\u9045\u523B","","\u30EA\u30D5\u30A1\u30FC\u30E9\u30EB","","\u30D3\u30B8\u30BF\u30FC","","TYFCB","","CEU","","\u63A8\u85A6\u306E\u3053\u3068\u3070","","","\u4ECA\u6708\u4F55\u3082\u3057\u306A\u304B\u3063\u305F\u5834\u5408\u306E\u70B9\u6570"],["","","","\u56DE\u6570","\u73FE\u5728","\u203B1","\u73FE\u5728","\u203B1","\u73FE\u5728","\u203B1","\u73FE\u5728","\u203B1","\u73FE\u5728","\u203B1","\u73FE\u5728","\u203B1","\u73FE\u5728","\u203B1","",],["","\u59D3","\u540D","","\u8A08","","\u8A08","","\u8A08","","\u8A08","","\u8A08","","\u8A08","","\u8A08","","","\u6B20\u5E2D","\u9045\u523B","\u30EA\u30D5\u30A1\u30FC\u30E9\u30EB","\u30D3\u30B8\u30BF\u30FC","\u30B5\u30F3\u30AD\u30E5\u30FC\u91D1\u984D","CEU","\u63A8\u85A6\u306E\u8A00\u8449","\u70B9\u6570"],];for(let A in g_members){let d=g_members[A],b=[],B=d[a.REPORT_DATE_NICE],q=Object.keys(B).sort().reduce((a,b)=>(a[b]=B[b],a),{}),j=q[Object.keys(q)[0]];b.push(""),b.push(d[a.LAST_NAME_NICE]),b.push(d[a.FIRST_NAME_NICE]),b.push(d[a.ATTENDANCE_NICE]),b.push(d[a.ABSENT_NICE]),b.push(d[a.ABSENT_NICE]-j[a.ABSENT_NICE]),b.push(d[a.LATE_NICE]),b.push(d[a.LATE_NICE]-j[a.LATE_NICE]),b.push(d[a.REFERRAL_FINAL]),b.push(d[a.REFERRAL_FINAL]-j[a.REFERRAL_FINAL]),b.push(d[a.VISITOR_NICE]),b.push(d[a.VISITOR_NICE]-j[a.VISITOR_NICE]),b.push(d[a.TYFCB_NICE]),b.push(d[a.TYFCB_NICE]-j[a.TYFCB_NICE]),b.push(d[a.CEU_NICE]),b.push(d[a.CEU_NICE]-j[a.CEU_NICE]),b.push(d[a.RECOMMENDATION_NICE]),b.push(d[a.RECOMMENDATION_NICE]-j[a.RECOMMENDATION_NICE]),b.push("");let r=h.getScore(a.ABSENT,d[a.ABSENT_NICE]),s=h.getScore(a.LATE,d[a.LATE_NICE]),t=h.getScore(a.REFERRAL_FINAL,d[a.REFERRAL_FINAL]),u=h.getScore(a.VISITOR,d[a.VISITOR_NICE]),v=h.getScore(a.TYFCB,d[a.TYFCB_NICE]),w=h.getScore(a.CEU,d[a.CEU_NICE]),x=h.getScore(a.RECOMMENDATION,d[a.RECOMMENDATION_NICE]);b.push(r),b.push(s),b.push(t),b.push(u),b.push(v),b.push(w),b.push(x);let y=0;y=r+s+t+u+v+w+x,b.push(y),p.push(b)}let e=XLSX.utils.aoa_to_sheet(p),C=XLSX.utils.decode_range("G2:H2"),D=XLSX.utils.decode_range("I2:J2"),E=XLSX.utils.decode_range("K2:L2"),F=XLSX.utils.decode_range("M2:N2"),G=XLSX.utils.decode_range("O2:P2"),H=XLSX.utils.decode_range("Q2:R2"),I=XLSX.utils.decode_range("T2:AA3");e["!merges"]||(e["!merges"]=[]),e["!merges"].push({s:{r:1,c:4},e:{r:1,c:5}}),e["!merges"].push(C),e["!merges"].push(D),e["!merges"].push(E),e["!merges"].push(F),e["!merges"].push(G),e["!merges"].push(H),e["!merges"].push(I);var l=XLSX.utils.decode_range(e["!ref"]),J=l.e.r,m=l.e.c;let K={alignment:{vertical:"center",horizontal:"center"}};for(let g=l.s.r;g<=J;++g)for(let f=l.s.c;f<=m;++f){let L={c:f,r:g},i=XLSX.utils.encode_cell(L);if(e[i]){if(e[i].s={...K},g>3&&f==m){let M=h.getRankColor(e[i].v);e[i].s.fill={fgColor:{rgb:M}}}g>3&&(5==f||7==f||9==f||11==f||13==f||15==f||17==f)&&(e[i].s.fill={fgColor:{rgb:"8EAADB"}}),(g>2&&(f>0&&f<18||f>18&&f<=m)||g>1&&f>2&&f<18)&&(e[i].s.border={top:{style:"thin",color:"000000"},bottom:{style:"thin",color:"000000"},left:{style:"thin",color:"000000"},right:{style:"thin",color:"000000"}}),(3==g&&f>0&&f<18||2==g&&f>2&&f<18)&&(e[i].s.fill={fgColor:{rgb:"BFBFBF"}}),3==g&&f>0&&f<18&&(e[i].s.font={bold:!0,sz:"14"})}}["T2","D2","E2","G2","I2","K2","M2","O2","Q2"].forEach(function(a){e[a]||(e[a]={s:{},v:"",t:"s"}),e[a].s={border:{top:{style:"medium",color:"000000"},left:{style:"medium",color:"000000"}}}}),["U2","V2","W2","X2","Y2","Z2"].forEach(function(a){e[a]||(e[a]={s:{},v:"",t:"s"}),e[a].s={border:{top:{style:"medium",color:"000000"}}}}),["AA2","F2","H2","J2","L2","N2","P2","R2"].forEach(function(a){e[a]||(e[a]={s:{},v:"",t:"s"}),e[a].s={border:{top:{style:"medium",color:"000000"},right:{style:"medium",color:"000000"}}}}),["AA3"].forEach(function(a){e[a]||(e[a]={s:{},v:"",t:"s"}),e[a].s={border:{bottom:{style:"medium",color:"000000"},right:{style:"medium",color:"000000"}}}}),["U3","V3","W3","X3","Y3","Z3"].forEach(function(a){e[a]||(e[a]={s:{},v:"",t:"s"}),e[a].s={border:{bottom:{style:"medium",color:"000000"}}}}),["T3"].forEach(function(a){e[a]||(e[a]={s:{},v:"",t:"s"}),e[a].s={border:{bottom:{style:"medium",color:"000000"},left:{style:"medium",color:"000000"}}}}),e.T2.s.font={color:{rgb:"FF0000"}},e.T2.s.alignment={vertical:"center",horizontal:"center"},e.B1.s.alignment={vertical:"center",horizontal:"left"},e.B1.s.font={sz:"14"};var n=[];for(let k=0;k<=m;k++)0==k?n.push({wch:2}):1==k||2==k?n.push({wch:10}):n.push({wch:5});e["!cols"]=n;let o=XLSX.utils.book_new(),z="Report";o.SheetNames.push(z),o.Sheets[z]=e,XLSX.writeFile(o,`${getFirstDayOfCurrentMonth()}.xlsx`)})()});class c{constructor(a){this.KEY=a}getScore=function(b,c){let a=0;if(b==this.KEY.ABSENT)switch(c){case 2:a=5;break;case 1:a=10;break;case 0:a=15;break;default:a=0}else if(b==this.KEY.LATE)switch(c){case 1:default:a=0;break;case 0:a=5}else if(b==this.KEY.REFERRAL_FINAL)switch(c){case .75:a=5;break;case 1:a=10;break;case 1.5:a=15;break;case 2:a=20;break;default:a=0}else if(b==this.KEY.VISITOR)switch(c){case 2:a=5;break;case 4:a=10;break;case 6:a=15;break;case 12:a=20;break;default:a=0}else if(b==this.KEY.TYFCB)switch(c){case 200:a=5;break;case 500:a=10;break;case 1e3:a=15;break;default:a=0}else if(b==this.KEY.CEU)switch(c){case 10:a=5;break;case 15:a=10;break;case 20:a=15;break;default:a=0}else if(b==this.KEY.RECOMMENDATION)switch(c){case 1:a=5;break;case 2:a=10;break;default:a=0}return a};getRankColor=function(a){return 100==a?"00B050":a>=70&&a<=95?"92D050":a>=50&&a<=65?"FFFF00":a>=30&&a<=45?"FF0000":a>=0&&a<=25?"BFBFBF":void 0}}class d{parseExcel=function(b){var a=new FileReader;a.onload=function(a){var b=a.target.result,c=XLSX.read(b,{type:"binary"});c.SheetNames.forEach(function(a){var b=XLSX.utils.sheet_to_row_object_array(c.Sheets[a]),d=JSON.stringify(b);g_xlsxData.push(JSON.parse(d))})},a.onerror=function(a){console.log(a)},a.readAsBinaryString(b)}}});class Logger{constructor(a){this.debug=a}info=function(...a){this.debug&&console.log(...a)};warn=function(...a){this.debug&&console.warn(...a)}}